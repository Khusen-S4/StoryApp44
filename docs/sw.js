self.addEventListener("push",(e=>{console.log("[SW] Push event diterima");const t=e.data?.json()||{};console.log("[SW] Data push:",t);const a=t.title||"Story Baru ðŸŽ‰",s={body:t.body||"Ada story baru yang ditambahkan",icon:"/icons/icon-192x192.png",badge:"/icons/icon-192x192.png"};e.waitUntil(self.registration.showNotification(a,s).then((()=>{console.log("[SW] Notifikasi berhasil ditampilkan")})))}));const CACHE_NAME="story-app-v1",STATIC_ASSETS=["/","/index.html","/images/marker-bawah.png","/images/gambar-error.png","/styles/styles.css"];self.addEventListener("install",(e=>{e.waitUntil(caches.open(CACHE_NAME).then((e=>Promise.all(STATIC_ASSETS.map((async t=>{try{await e.add(t)}catch(e){console.warn("[SW] Gagal cache:",t,e)}})))))),self.skipWaiting()})),self.addEventListener("activate",(e=>{e.waitUntil(self.clients.claim())})),self.addEventListener("fetch",(e=>{new URL(e.request.url).pathname.startsWith("/v1/stories")?e.respondWith(caches.open(CACHE_NAME).then((t=>fetch(e.request).then((a=>(t.put(e.request,a.clone()),a))).catch((()=>t.match(e.request)))))):e.respondWith(caches.match(e.request).then((t=>t||fetch(e.request))))}));