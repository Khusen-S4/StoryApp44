const BASE_PATH="/StoryApp44/",CACHE_NAME="story-app-v3",APP_SHELL=["/StoryApp44/","/StoryApp44/indexoff.html","/StoryApp44/manifest.json","/StoryApp44/sw.js","/StoryApp44/styles/styles.css","/StoryApp44/images/gambar-error.png","/StoryApp44/images/layers-2x.png","/StoryApp44/images/layers.png","/StoryApp44/images/logo.png","/StoryApp44/images/marker-bawah.png","/StoryApp44/images/marker-icon.png","/StoryApp44/images/marker-shadow.png","/StoryApp44/images/st317.png"];self.addEventListener("push",(t=>{console.log("[SW] Push event diterima");let e={title:"Story Baru ðŸŽ‰",body:"Ada story baru yang ditambahkan"};if(t.data)try{e=t.data.json()}catch{e.body=t.data.text()}const a={body:e.body,icon:`${BASE_PATH}icons/icon-192x192.png`,badge:`${BASE_PATH}icons/icon-192x192.png`};t.waitUntil(self.registration.showNotification(e.title,a))})),self.addEventListener("message",(t=>{if("NEW_STORY"!==t.data?.type)return;const{title:e,body:a}=t.data.payload;self.registration.showNotification(e,{body:a,icon:`${BASE_PATH}icons/icon-192x192.png`,badge:`${BASE_PATH}icons/icon-192x192.png`})})),self.addEventListener("install",(t=>{self.skipWaiting(),t.waitUntil(caches.open(CACHE_NAME).then((async t=>{for(const e of APP_SHELL)try{const a=await fetch(e,{cache:"no-store"});a.ok&&await t.put(e,a)}catch(t){console.warn("[SW] gagal cache:",e)}})))})),self.addEventListener("activate",(t=>{t.waitUntil(caches.keys().then((t=>Promise.all(t.map((t=>{if(t!==CACHE_NAME)return caches.delete(t)})))))),self.clients.claim()})),self.addEventListener("fetch",(t=>{if("GET"!==t.request.method)return;if("navigate"===t.request.mode)return void t.respondWith(fetch(t.request).catch((()=>caches.match(`${BASE_PATH}indexoff.html`))));const e=new URL(t.request.url);"https://story-api.dicoding.dev"===e.origin&&e.pathname.startsWith("/v1/stories")?t.respondWith(caches.open(CACHE_NAME).then((async e=>{try{const a=await fetch(t.request);return e.put(t.request,a.clone()),a}catch{return e.match(t.request)}}))):t.respondWith(caches.match(t.request).then((e=>e||fetch(t.request))))}));