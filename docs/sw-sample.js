const BASE_PATH=self.location.pathname.includes("StoryApp44")?"/StoryApp44/":"/",CACHE_NAME="story-app-v4",APP_SHELL=[`${BASE_PATH}`,`${BASE_PATH}indexoff.html`,`${BASE_PATH}manifest.json`,`${BASE_PATH}sw.js`,`${BASE_PATH}styles/styles.css`,`${BASE_PATH}images/gambar-error.png`,`${BASE_PATH}images/layers-2x.png`,`${BASE_PATH}images/layers.png`,`${BASE_PATH}images/logo.png`,`${BASE_PATH}images/marker-bawah.png`,`${BASE_PATH}images/marker-icon.png`,`${BASE_PATH}images/marker-shadow.png`,`${BASE_PATH}images/st317.png`];self.addEventListener("push",(e=>{let t={title:"Story Baru ðŸŽ‰",body:"Ada story baru yang ditambahkan"};if(e.data)try{t=e.data.json()}catch{t.body=e.data.text()}e.waitUntil(self.registration.showNotification(t.title,{body:t.body,icon:`${BASE_PATH}icons/icon-192x192.png`,badge:`${BASE_PATH}icons/icon-192x192.png`}))})),self.addEventListener("message",(e=>{if("NEW_STORY"!==e.data?.type)return;const{title:t,body:a}=e.data.payload;self.registration.showNotification(t,{body:a,icon:`${BASE_PATH}icons/icon-192x192.png`,badge:`${BASE_PATH}icons/icon-192x192.png`})})),self.addEventListener("install",(e=>{self.skipWaiting(),e.waitUntil(caches.open(CACHE_NAME).then((async e=>{for(const t of APP_SHELL)try{const a=await fetch(t,{cache:"no-store"});a.ok&&await e.put(t,a)}catch(e){console.warn("[SW] skip cache:",t)}})))})),self.addEventListener("activate",(e=>{e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>{if(e!==CACHE_NAME)return caches.delete(e)})))))),self.clients.claim()})),self.addEventListener("fetch",(e=>{if("GET"!==e.request.method)return;if("navigate"===e.request.mode)return void e.respondWith(caches.match(`${BASE_PATH}indexoff.html`).then((e=>e||fetch(`${BASE_PATH}`))));const t=new URL(e.request.url);"https://story-api.dicoding.dev"===t.origin&&t.pathname.startsWith("/v1/stories")?e.respondWith(caches.open(CACHE_NAME).then((async t=>{try{const a=await fetch(e.request);return t.put(e.request,a.clone()),a}catch{return t.match(e.request)}}))):e.respondWith(caches.match(e.request).then((t=>t||fetch(e.request))))}));